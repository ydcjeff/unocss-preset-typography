name: deps

on:
  schedule:
    - cron: '12 12 * * mon'
  workflow_dispatch:

jobs:
  upgrade:
    if: github.repository_owner == 'ydcjeff'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: pnpm/action-setup@v2
        with:
          version: latest

      - uses: actions/setup-node@v2
        with:
          node-version: 16
          cache: pnpm

      - run: rm -rf pnpm-lock.yaml
      - run: pnpm up -r
      - run: pnpm fmt
      - uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore(deps): bump deps'
          title: 'chore(deps): bump deps'
          body: >
            This PR is auto-generated by a nightly GitHub action. It should
            automatically be merged if tests pass.
